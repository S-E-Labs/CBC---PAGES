<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inventario - Empleado</title>
  <link rel="icon" href="../../Assests/Img/favicon.png" type="image/png"/>
  <!-- Font Awesome para íconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <!-- Chart.js para gráficos -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Estilos generales */
    :root {
      --primary-color: #3498db;
      --secondary-color: #2980b9;
      --danger-color: #e74c3c;
      --danger-hover: #c0392b;
      --success-color: #2ecc71;
      --warning-color: #f39c12;
      --light-color: #ecf0f1;
      --dark-color: #2c3e50;
      --gray-color: #95a5a6;
      --white-color: #ffffff;
      --border-radius: 8px;
      --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }

    /* Layout del dashboard */
    .dashboard-container {
      display: grid;
      grid-template-columns: 250px 1fr;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      background-color: var(--dark-color);
      color: var(--white-color);
      padding: 20px 0;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    }

    .sidebar-header {
      padding: 0 20px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar-header h2 {
      font-size: 1.5rem;
      margin-bottom: 5px;
    }

    .sidebar-header p {
      color: var(--gray-color);
      font-size: 0.9rem;
    }

    .sidebar-menu {
      margin-top: 20px;
    }

    .menu-item {
      padding: 12px 20px;
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: var(--transition);
    }

    .menu-item:hover, .menu-item.active {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .menu-item i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }

    /* Contenido principal */
    .main-content {
      padding: 20px;
      overflow-y: auto;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid #e0e0e0;
    }

    .header-title h1 {
      font-size: 1.8rem;
      color: var(--dark-color);
    }

    .header-title p {
      color: var(--gray-color);
      font-size: 0.9rem;
    }

    .user-info {
      display: flex;
      align-items: center;
    }

    .user-info img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
      object-fit: cover;
    }

    .user-details h4 {
      font-size: 1rem;
      margin-bottom: 2px;
    }

    .user-details p {
      font-size: 0.8rem;
      color: var(--gray-color);
    }

    /* Tarjetas de resumen */
    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      background-color: var(--white-color);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--box-shadow);
      transition: var(--transition);
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .card-title {
      font-size: 1rem;
      color: var(--gray-color);
    }

    .card-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--white-color);
    }

    .card-icon.blue {
      background-color: var(--primary-color);
    }

    .card-icon.green {
      background-color: var(--success-color);
    }

    .card-icon.orange {
      background-color: var(--warning-color);
    }

    .card-icon.red {
      background-color: var(--danger-color);
    }

    .card-value {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .card-description {
      font-size: 0.9rem;
      color: var(--gray-color);
    }

    /* Panel de filtros */
    .filter-panel {
      background-color: var(--white-color);
      border-radius: var(--border-radius);
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: var(--box-shadow);
    }

    .filter-row {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }

    .filter-group {
      margin-bottom: 0;
    }

    .filter-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--dark-color);
    }

    .filter-group select, 
    .filter-group input {
      width: 100%;
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      font-family: 'Roboto', sans-serif;
      transition: var(--transition);
    }

    .filter-group select:focus, 
    .filter-group input:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }

    /* Tabla de productos */
    .table-container {
      background-color: var(--white-color);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      overflow: hidden;
      margin-bottom: 30px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    th {
      background-color: var(--primary-color);
      color: var(--white-color);
      font-weight: 500;
      text-transform: uppercase;
      font-size: 0.8rem;
      letter-spacing: 0.5px;
    }

    tr:hover {
      background-color: #f9f9f9;
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .badge-primary {
      background-color: rgba(52, 152, 219, 0.1);
      color: var(--primary-color);
    }

    .badge-success {
      background-color: rgba(46, 204, 113, 0.1);
      color: var(--success-color);
    }

    .badge-warning {
      background-color: rgba(243, 156, 18, 0.1);
      color: var(--warning-color);
    }

    .badge-danger {
      background-color: rgba(231, 76, 60, 0.1);
      color: var(--danger-color);
    }

    .comentario-input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      font-family: 'Roboto', sans-serif;
      transition: var(--transition);
    }

    .comentario-input:focus {
      border-color: var(--primary-color);
      outline: none;
    }

    .actions {
      display: flex;
      gap: 5px;
    }

    .btn {
      padding: 8px 12px;
      border: none;
      border-radius: var(--border-radius);
      font-family: 'Roboto', sans-serif;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn-sm {
      padding: 5px 10px;
      font-size: 0.8rem;
    }

    .btn-primary {
      background-color: var(--primary-color);
      color: var(--white-color);
    }

    .btn-primary:hover {
      background-color: var(--secondary-color);
    }

    .btn-danger {
      background-color: var(--danger-color);
      color: var(--white-color);
    }

    .btn-danger:hover {
      background-color: var(--danger-hover);
    }

    .btn-success {
      background-color: var(--success-color);
      color: var(--white-color);
    }

    .btn-success:hover {
      background-color: #27ae60;
    }

    .btn i {
      margin-right: 5px;
    }

    /* Sección de gráficos */
    .chart-container {
      background-color: var(--white-color);
      border-radius: var(--border-radius);
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: var(--box-shadow);
    }

    .chart-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .chart-wrapper {
      position: relative;
      height: 300px;
    }

    /* Alertas */
    .alert-item {
      background-color: var(--white-color);
      border-left: 4px solid var(--warning-color);
      padding: 15px;
      margin-bottom: 15px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      display: flex;
      align-items: center;
    }

    .alert-item.critical {
      border-left-color: var(--danger-color);
    }

    .alert-item.warning {
      border-left-color: var(--warning-color);
    }

    .alert-item.info {
      border-left-color: var(--primary-color);
    }

    .alert-icon {
      font-size: 1.5rem;
      margin-right: 15px;
      width: 40px;
      text-align: center;
    }

    .alert-content {
      flex: 1;
    }

    .alert-title {
      font-weight: 500;
      margin-bottom: 5px;
    }

    .alert-description {
      font-size: 0.9rem;
      color: var(--gray-color);
    }

    .alert-time {
      font-size: 0.8rem;
      color: var(--gray-color);
      text-align: right;
      min-width: 100px;
    }

    /* Configuración */
    .settings-form {
      background-color: var(--white-color);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--box-shadow);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .form-group input, 
    .form-group select, 
    .form-group textarea {
      width: 100%;
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      font-family: 'Roboto', sans-serif;
    }

    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 30px;
    }

    /* Responsive */
    @media (max-width: 992px) {
      .dashboard-container {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        display: none;
      }

      .chart-row {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .user-info {
        margin-top: 15px;
      }
    }
  </style>
</head>
<body>
  <!-- Contenedor principal del dashboard -->
  <div class="dashboard-container">
    <!-- Sidebar / Menú lateral -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Inventario App</h2>
        <p>Panel de empleado</p>
      </div>
      
      <nav class="sidebar-menu">
        <div class="menu-item active" onclick="mostrarSeccion('inventario')">
          <i class="fas fa-boxes"></i>
          <span>Inventario</span>
        </div>
        <div class="menu-item" onclick="mostrarSeccion('reportes')">
          <i class="fas fa-chart-line"></i>
          <span>Reportes</span>
        </div>
        <div class="menu-item" onclick="mostrarSeccion('alertas')">
          <i class="fas fa-bell"></i>
          <span>Alertas</span>
        </div>
        <div class="menu-item" onclick="mostrarSeccion('configuracion')">
          <i class="fas fa-cog"></i>
          <span>Configuración</span>
        </div>
        <div class="menu-item" onclick="cerrarSesion()">
          <i class="fas fa-sign-out-alt"></i>
          <span>Cerrar Sesión</span>
        </div>
      </nav>
    </aside>

    <!-- Contenido principal -->
    <main class="main-content">
      <!-- Header -->
      <header class="header">
        <div class="header-title">
          <h1 id="tituloSeccion">Gestión de Inventario</h1>
          <p id="saludoEmpleado">Bienvenido de nuevo</p>
        </div>
        
        <div class="user-info">
          <img src="https://ui-avatars.com/api/?name=Usuario+Empleado&background=3498db&color=fff" alt="Usuario">
          <div class="user-details">
            <h4 id="nombreUsuario">Usuario Empleado</h4>
            <p>Rol: <span id="rolUsuario">Empleado</span></p>
          </div>
        </div>
      </header>

      <!-- Sección de Inventario (visible por defecto) -->
      <section id="seccion-inventario" class="dashboard-section">
        <!-- Tarjetas de resumen -->
        <div class="summary-cards">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Productos totales</h3>
              <div class="card-icon blue">
                <i class="fas fa-boxes"></i>
              </div>
            </div>
            <h2 class="card-value" id="totalProductos">0</h2>
            <p class="card-description">En todas las categorías</p>
          </div>
          
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Stock bajo</h3>
              <div class="card-icon orange">
                <i class="fas fa-exclamation-triangle"></i>
              </div>
            </div>
            <h2 class="card-value" id="stockBajo">0</h2>
            <p class="card-description">Productos con menos de 10 unidades</p>
          </div>
          
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Categorías</h3>
              <div class="card-icon green">
                <i class="fas fa-tags"></i>
              </div>
            </div>
            <h2 class="card-value" id="totalCategorias">5</h2>
            <p class="card-description">Diferentes categorías</p>
          </div>
          
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Comentarios</h3>
              <div class="card-icon red">
                <i class="fas fa-comment-alt"></i>
              </div>
            </div>
            <h2 class="card-value" id="totalComentarios">0</h2>
            <p class="card-description">Comentarios agregados</p>
          </div>
        </div>

        <!-- Panel de filtros -->
        <div class="filter-panel">
          <h3>Filtrar productos</h3>
          <div class="filter-row">
            <div class="filter-group">
              <label for="categoria">Categoría</label>
              <select id="categoria" onchange="mostrarProductos()">
                <option value="">Todas las categorías</option>
                <option value="lavamanos">Lavamanos</option>
                <option value="muebles">Muebles</option>
                <option value="sanitarios">Sanitarios</option>
                <option value="grifos">Grifos</option>
                <option value="accesorios">Accesorios</option>
              </select>
            </div>
            
            <div class="filter-group">
              <label for="buscar">Buscar producto</label>
              <input 
                type="text" 
                id="buscar" 
                oninput="filtrarProductos()" 
                placeholder="Buscar por nombre o código..."
              >
            </div>
            
            <div class="filter-group">
              <label for="stock">Estado de stock</label>
              <select id="stock" onchange="filtrarProductos()">
                <option value="">Todos</option>
                <option value="bajo">Stock bajo (<10)</option>
                <option value="medio">Stock medio (10-50)</option>
                <option value="alto">Stock alto (>50)</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Tabla de productos -->
        <div class="table-container">
          <table id="tablaProductos">
            <thead>
              <tr>
                <th>Categoría</th>
                <th>Código</th>
                <th>Nombre</th>
                <th>Precio</th>
                <th>Cantidad</th>
                <th>Estado</th>
                <th>Comentarios</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Sección de Reportes (oculta por defecto) -->
      <section id="seccion-reportes" class="dashboard-section" style="display: none;">
        <div class="chart-container">
          <h2>Reportes de Inventario</h2>
          <p>Visualiza el estado actual del inventario</p>
          
          <div class="chart-row">
            <div class="chart-wrapper">
              <canvas id="chartStock"></canvas>
            </div>
            <div class="chart-wrapper">
              <canvas id="chartCategorias"></canvas>
            </div>
          </div>
          
          <div class="chart-row">
            <div class="chart-wrapper">
              <canvas id="chartPrecios"></canvas>
            </div>
            <div class="chart-wrapper">
              <canvas id="chartEstadoStock"></canvas>
            </div>
          </div>
        </div>
        
        <div class="table-container">
          <h3>Productos con stock crítico (<10 unidades)</h3>
          <table id="tablaStockBajo">
            <thead>
              <tr>
                <th>Código</th>
                <th>Nombre</th>
                <th>Categoría</th>
                <th>Stock Actual</th>
                <th>Última Actualización</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Sección de Alertas (oculta por defecto) -->
      <section id="seccion-alertas" class="dashboard-section" style="display: none;">
        <div class="filter-panel">
          <h2>Alertas del Sistema</h2>
          <div class="filter-row">
            <div class="filter-group">
              <label for="filtroTipoAlerta">Tipo de alerta</label>
              <select id="filtroTipoAlerta" onchange="filtrarAlertas()">
                <option value="">Todas</option>
                <option value="critica">Críticas</option>
                <option value="advertencia">Advertencias</option>
                <option value="informacion">Información</option>
              </select>
            </div>
            
            <div class="filter-group">
              <label for="filtroEstadoAlerta">Estado</label>
              <select id="filtroEstadoAlerta" onchange="filtrarAlertas()">
                <option value="">Todas</option>
                <option value="no-leida">No leídas</option>
                <option value="leida">Leídas</option>
              </select>
            </div>
          </div>
        </div>
        
        <div id="listaAlertas">
          <!-- Las alertas se generarán dinámicamente con JavaScript -->
        </div>
      </section>

      <!-- Sección de Configuración (oculta por defecto) -->
      <section id="seccion-configuracion" class="dashboard-section" style="display: none;">
        <div class="settings-form">
          <h2>Configuración de Usuario</h2>
          
          <div class="form-group">
            <label for="nombreUsuarioConfig">Nombre de usuario</label>
            <input type="text" id="nombreUsuarioConfig" value="empleado1">
          </div>
          
          <div class="form-group">
            <label for="emailUsuario">Correo electrónico</label>
            <input type="email" id="emailUsuario" value="empleado@empresa.com">
          </div>
          
          <div class="form-group">
            <label for="telefonoUsuario">Teléfono</label>
            <input type="tel" id="telefonoUsuario" value="+1234567890">
          </div>
          
          <div class="form-group">
            <label for="notificaciones">Preferencias de notificación</label>
            <select id="notificaciones">
              <option value="todas">Todas las notificaciones</option>
              <option value="criticas">Solo alertas críticas</option>
              <option value="ninguna">No recibir notificaciones</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="limiteStock">Límite para stock bajo</label>
            <input type="number" id="limiteStock" value="10" min="1">
            <small>El sistema generará alertas cuando el stock esté por debajo de este valor</small>
          </div>
          
          <div class="form-actions">
            <button class="btn btn-danger" onclick="mostrarSeccion('inventario')">
              <i class="fas fa-times"></i> Cancelar
            </button>
            <button class="btn btn-success" onclick="guardarConfiguracion()">
              <i class="fas fa-save"></i> Guardar Cambios
            </button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // Constantes y variables globales
    const categorias = ["lavamanos", "muebles", "sanitarios", "grifos", "accesorios"];
    let productosGlobales = []; // Almacena todos los productos para filtrado
    let alertasGlobales = []; // Almacena todas las alertas del sistema
    let charts = {}; // Objeto para almacenar las instancias de gráficos

    // Función que se ejecuta al cargar la página
    window.addEventListener('DOMContentLoaded', () => {
      // Verificar autenticación
      verificarAutenticacion();
      
      // Cargar datos del usuario
      cargarDatosUsuario();
      
      // Cargar datos iniciales
      cargarProductos();
      cargarAlertas();
      
      // Mostrar sección de inventario por defecto
      mostrarSeccion('inventario');
    });

    /**
     * Verifica si el usuario está autenticado y tiene el rol correcto
     */
    function verificarAutenticacion() {
      const usuario = sessionStorage.getItem('usuario');
      const rol = sessionStorage.getItem('rol');

      if (!usuario || rol !== 'empleado') {
        window.location.href = "../../../Pages/index.html";
      }
    }

    /**
     * Carga y muestra los datos del usuario en el header
     */
    function cargarDatosUsuario() {
      const usuario = sessionStorage.getItem('usuario');
      const rol = sessionStorage.getItem('rol');
      
      document.getElementById('nombreUsuario').textContent = usuario;
      document.getElementById('nombreUsuarioConfig').value = usuario;
      document.getElementById('rolUsuario').textContent = rol;
      document.getElementById('saludoEmpleado').textContent = `Bienvenido, ${usuario}`;
    }

    /**
     * Carga todos los productos desde localStorage
     */
    function cargarProductos() {
      productosGlobales = [];
      
      for (let categoria of categorias) {
        const productos = JSON.parse(localStorage.getItem(categoria)) || [];
        // Agregar fecha de actualización simulada si no existe
        const productosConFecha = productos.map(p => ({ 
          ...p, 
          categoria,
          ultimaActualizacion: p.ultimaActualizacion || new Date().toISOString()
        }));
        productosGlobales = productosGlobales.concat(productosConFecha);
      }
      
      // Si no hay productos, cargar algunos de ejemplo
      if (productosGlobales.length === 0) {
        cargarProductosEjemplo();
      }
      
      mostrarProductos();
    }

    /**
     * Carga productos de ejemplo (solo para demostración)
     */
    function cargarProductosEjemplo() {
      const productosEjemplo = {
        lavamanos: [
          { codigo: "LV-001", nombre: "Lavamanos de porcelana", precio: 120.50, cantidad: 15 },
          { codigo: "LV-002", nombre: "Lavamanos de mármol", precio: 250.75, cantidad: 5 },
          { codigo: "LV-003", nombre: "Lavamanos moderno", precio: 180.00, cantidad: 8 }
        ],
        muebles: [
          { codigo: "MB-001", nombre: "Mueble para baño 60cm", precio: 320.00, cantidad: 12 },
          { codigo: "MB-002", nombre: "Mueble para baño 80cm", precio: 420.00, cantidad: 3 },
          { codigo: "MB-003", nombre: "Mueble con espejo", precio: 380.50, cantidad: 7 }
        ],
        sanitarios: [
          { codigo: "SN-001", nombre: "Inodoro estándar", precio: 150.00, cantidad: 20 },
          { codigo: "SN-002", nombre: "Inodoro suspendido", precio: 280.00, cantidad: 6 },
          { codigo: "SN-003", nombre: "Inodoro inteligente", precio: 1200.00, cantidad: 2 }
        ],
        grifos: [
          { codigo: "GF-001", nombre: "Grifo lavamanos", precio: 85.00, cantidad: 25 },
          { codigo: "GF-002", nombre: "Grifo ducha", precio: 120.00, cantidad: 9 },
          { codigo: "GF-003", nombre: "Grifo cocina", precio: 95.50, cantidad: 14 }
        ],
        accesorios: [
          { codigo: "AC-001", nombre: "Porta toallas", precio: 35.00, cantidad: 30 },
          { codigo: "AC-002", nombre: "Jabonera", precio: 25.50, cantidad: 4 },
          { codigo: "AC-003", nombre: "Espejo redondo", precio: 75.00, cantidad: 8 }
        ]
      };

      // Guardar productos de ejemplo en localStorage
      for (let categoria in productosEjemplo) {
        localStorage.setItem(categoria, JSON.stringify(productosEjemplo[categoria]));
      }
      
      // Recargar productos
      cargarProductos();
    }

    /**
     * Muestra los productos en la tabla, opcionalmente filtrados
     * @param {Array} [productosFiltrados] - Productos filtrados a mostrar
     */
    function mostrarProductos(productosFiltrados = null) {
      const tbody = document.querySelector("#tablaProductos tbody");
      tbody.innerHTML = "";

      const productosAMostrar = productosFiltrados || productosGlobales;

      if (productosAMostrar.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8" style="text-align: center; padding: 30px;">
              No se encontraron productos. Prueba con otros filtros.
            </td>
          </tr>
        `;
        return;
      }

      productosAMostrar.forEach((prod) => {
        const tr = document.createElement("tr");
        
        // Determinar estado del stock
        let estado = "";
        let badgeClass = "";
        if (prod.cantidad < 10) {
          estado = "Bajo";
          badgeClass = "badge-danger";
        } else if (prod.cantidad < 50) {
          estado = "Medio";
          badgeClass = "badge-warning";
        } else {
          estado = "Alto";
          badgeClass = "badge-success";
        }
        
        // Obtener comentario guardado
        const comentarioKey = `comentario_${prod.categoria}_${prod.codigo}`;
        const comentarioGuardado = localStorage.getItem(comentarioKey) || "";

        tr.innerHTML = `
          <td><span class="badge badge-primary">${prod.categoria}</span></td>
          <td>${prod.codigo}</td>
          <td>${prod.nombre}</td>
          <td>$${parseFloat(prod.precio).toFixed(2)}</td>
          <td>${prod.cantidad}</td>
          <td><span class="badge ${badgeClass}">${estado}</span></td>
          <td>
            <input 
              type="text" 
              class="comentario-input" 
              value="${comentarioGuardado.replace(/"/g, '&quot;')}" 
              placeholder="Agregar comentario..." 
              oninput="guardarComentario('${prod.categoria}', '${prod.codigo}', this.value)"
            />
          </td>
          <td class="actions">
            <button class="btn btn-primary btn-sm" onclick="editarProducto('${prod.categoria}', '${prod.codigo}')">
              <i class="fas fa-edit"></i> Editar
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      
      // Actualizar estadísticas después de mostrar productos
      actualizarEstadisticas(productosAMostrar);
    }

    /**
     * Filtra los productos por los criterios seleccionados
     */
    function filtrarProductos() {
      const texto = document.getElementById("buscar").value.toLowerCase();
      const categoriaSeleccionada = document.getElementById("categoria").value;
      const filtroStock = document.getElementById("stock").value;
      
      let productosFiltrados = productosGlobales;
      
      // Filtrar por texto (nombre o código)
      if (texto) {
        productosFiltrados = productosFiltrados.filter(p => 
          p.nombre.toLowerCase().includes(texto) || 
          p.codigo.toLowerCase().includes(texto)
        );
      }
      
      // Filtrar por categoría si hay una seleccionada
      if (categoriaSeleccionada) {
        productosFiltrados = productosFiltrados.filter(p => 
          p.categoria === categoriaSeleccionada
        );
      }
      
      // Filtrar por nivel de stock si hay uno seleccionado
      if (filtroStock) {
        productosFiltrados = filtrarPorStock(productosFiltrados, filtroStock);
      }
      
      mostrarProductos(productosFiltrados);
    }

    /**
     * Filtra productos por nivel de stock
     * @param {Array} productos - Productos a filtrar
     * @param {String} nivel - Nivel de stock ('bajo', 'medio', 'alto')
     */
    function filtrarPorStock(productos, nivel) {
      return productos.filter(p => {
        if (nivel === 'bajo') return p.cantidad < 10;
        if (nivel === 'medio') return p.cantidad >= 10 && p.cantidad < 50;
        if (nivel === 'alto') return p.cantidad >= 50;
        return true;
      });
    }

    /**
     * Guarda un comentario para un producto específico en localStorage
     * @param {String} categoria - Categoría del producto
     * @param {String} codigo - Código del producto
     * @param {String} texto - Texto del comentario
     */
    function guardarComentario(categoria, codigo, texto) {
      const key = `comentario_${categoria}_${codigo}`;
      localStorage.setItem(key, texto);
      
      // Actualizar contador de comentarios
      actualizarEstadisticas();
      
      // Generar alerta si el comentario indica un problema
      if (texto.toLowerCase().includes('urgente') || texto.toLowerCase().includes('falta')) {
        generarAlerta(
          'Comentario urgente', 
          `El producto ${codigo} (${categoria}) tiene un comentario que requiere atención: "${texto}"`,
          'advertencia'
        );
      }
    }

    /**
     * Actualiza las estadísticas mostradas en las tarjetas
     * @param {Array} [productos] - Productos a considerar para las estadísticas
     */
    function actualizarEstadisticas(productos = null) {
      const productosAMostrar = productos || productosGlobales;
      
      // Contar productos totales
      document.getElementById('totalProductos').textContent = productosAMostrar.length;
      
      // Contar productos con stock bajo
      const stockBajo = productosAMostrar.filter(p => p.cantidad < 10).length;
      document.getElementById('stockBajo').textContent = stockBajo;
      
      // Contar categorías (siempre son 5 en este ejemplo)
      document.getElementById('totalCategorias').textContent = categorias.length;
      
      // Contar comentarios (esto requiere recorrer localStorage)
      let totalComentarios = 0;
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('comentario_')) {
          totalComentarios++;
        }
      }
      document.getElementById('totalComentarios').textContent = totalComentarios;
    }

    /**
     * Función para editar un producto
     * @param {String} categoria - Categoría del producto
     * @param {String} codigo - Código del producto
     */
    function editarProducto(categoria, codigo) {
      // Buscar el producto
      const producto = productosGlobales.find(p => p.categoria === categoria && p.codigo === codigo);
      
      if (!producto) return;
      
      // Mostrar modal de edición (simplificado para este ejemplo)
      const nuevoNombre = prompt("Nuevo nombre:", producto.nombre);
      if (nuevoNombre && nuevoNombre !== producto.nombre) {
        producto.nombre = nuevoNombre;
        
        // Actualizar en localStorage
        const productosCategoria = JSON.parse(localStorage.getItem(categoria)) || [];
        const index = productosCategoria.findIndex(p => p.codigo === codigo);
        if (index !== -1) {
          productosCategoria[index].nombre = nuevoNombre;
          localStorage.setItem(categoria, JSON.stringify(productosCategoria));
          
          // Recargar productos
          cargarProductos();
          
          // Generar alerta de actualización
          generarAlerta(
            'Producto actualizado', 
            `El producto ${codigo} (${categoria}) ha sido modificado`,
            'informacion'
          );
        }
      }
    }

    /**
     * Carga las alertas del sistema
     */
    function cargarAlertas() {
      alertasGlobales = JSON.parse(localStorage.getItem('alertas')) || [];
      
      // Si no hay alertas, generar algunas de ejemplo
      if (alertasGlobales.length === 0) {
        generarAlertasIniciales();
      }
    }

    /**
     * Genera alertas iniciales para demostración
     */
    function generarAlertasIniciales() {
      const alertasEjemplo = [
        {
          id: Date.now(),
          titulo: "Stock crítico en lavamanos",
          descripcion: "El lavamanos de mármol (LV-002) tiene solo 5 unidades en stock",
          tipo: "critica",
          fecha: new Date().toISOString(),
          leida: false
        },
        {
          id: Date.now() + 1,
          titulo: "Producto actualizado",
          descripcion: "El mueble para baño 80cm (MB-002) ha sido modificado",
          tipo: "informacion",
          fecha: new Date(Date.now() - 3600000).toISOString(),
          leida: true
        },
        {
          id: Date.now() + 2,
          titulo: "Comentario urgente",
          descripcion: "El inodoro estándar (SN-001) tiene un comentario que requiere atención",
          tipo: "advertencia",
          fecha: new Date(Date.now() - 7200000).toISOString(),
          leida: false
        }
      ];
      
      localStorage.setItem('alertas', JSON.stringify(alertasEjemplo));
      alertasGlobales = alertasEjemplo;
    }

    /**
     * Genera una nueva alerta
     * @param {String} titulo - Título de la alerta
     * @param {String} descripcion - Descripción detallada
     * @param {String} tipo - Tipo de alerta ('critica', 'advertencia', 'informacion')
     */
    function generarAlerta(titulo, descripcion, tipo) {
      const nuevaAlerta = {
        id: Date.now(),
        titulo,
        descripcion,
        tipo,
        fecha: new Date().toISOString(),
        leida: false
      };
      
      alertasGlobales.unshift(nuevaAlerta);
      localStorage.setItem('alertas', JSON.stringify(alertasGlobales));
      
      // Si estamos en la sección de alertas, actualizar la vista
      if (document.getElementById('seccion-alertas').style.display === 'block') {
        mostrarAlertas();
      }
    }

    /**
     * Muestra las alertas en la sección correspondiente
     */
    function mostrarAlertas() {
      const listaAlertas = document.getElementById('listaAlertas');
      listaAlertas.innerHTML = '';
      
      if (alertasGlobales.length === 0) {
        listaAlertas.innerHTML = `
          <div class="alert-item info">
            <div class="alert-icon">
              <i class="fas fa-info-circle"></i>
            </div>
            <div class="alert-content">
              No hay alertas para mostrar
            </div>
          </div>
        `;
        return;
      }
      
      alertasGlobales.forEach(alerta => {
        const alertaElement = document.createElement('div');
        let icono = '';
        let clase = '';
        
        switch(alerta.tipo) {
          case 'critica':
            icono = 'exclamation-triangle';
            clase = 'critical';
            break;
          case 'advertencia':
            icono = 'exclamation-circle';
            clase = 'warning';
            break;
          default:
            icono = 'info-circle';
            clase = 'info';
        }
        
        alertaElement.className = `alert-item ${clase} ${alerta.leida ? 'leida' : ''}`;
        alertaElement.innerHTML = `
          <div class="alert-icon">
            <i class="fas fa-${icono}"></i>
          </div>
          <div class="alert-content">
            <div class="alert-title">${alerta.titulo}</div>
            <div class="alert-description">${alerta.descripcion}</div>
          </div>
          <div class="alert-time">
            ${new Date(alerta.fecha).toLocaleString()}
            ${!alerta.leida ? '<span class="badge badge-danger">NUEVO</span>' : ''}
          </div>
        `;
        
        alertaElement.addEventListener('click', () => marcarAlertaComoLeida(alerta.id));
        listaAlertas.appendChild(alertaElement);
      });
    }

    /**
     * Filtra las alertas según los criterios seleccionados
     */
    function filtrarAlertas() {
      const tipo = document.getElementById('filtroTipoAlerta').value;
      const estado = document.getElementById('filtroEstadoAlerta').value;
      
      let alertasFiltradas = alertasGlobales;
      
      if (tipo) {
        alertasFiltradas = alertasFiltradas.filter(a => a.tipo === tipo);
      }
      
      if (estado) {
        const leida = estado === 'leida';
        alertasFiltradas = alertasFiltradas.filter(a => a.leida === leida);
      }
      
      // Mostrar alertas filtradas (en una implementación real, haríamos un renderizado parcial)
      mostrarAlertas(alertasFiltradas);
    }

    /**
     * Marca una alerta como leída
     * @param {Number} id - ID de la alerta
     */
    function marcarAlertaComoLeida(id) {
      const alerta = alertasGlobales.find(a => a.id === id);
      if (alerta && !alerta.leida) {
        alerta.leida = true;
        localStorage.setItem('alertas', JSON.stringify(alertasGlobales));
        mostrarAlertas();
      }
    }

    /**
     * Muestra la sección solicitada y oculta las demás
     * @param {String} seccion - Nombre de la sección a mostrar ('inventario', 'reportes', 'alertas', 'configuracion')
     */
    function mostrarSeccion(seccion) {
      // Ocultar todas las secciones
      document.querySelectorAll('.dashboard-section').forEach(el => {
        el.style.display = 'none';
      });
      
      // Desactivar todos los items del menú
      document.querySelectorAll('.menu-item').forEach(el => {
        el.classList.remove('active');
      });
      
      // Mostrar la sección solicitada
      document.getElementById(`seccion-${seccion}`).style.display = 'block';
      
      // Activar el item del menú correspondiente
      document.querySelector(`.menu-item[onclick="mostrarSeccion('${seccion}')"]`).classList.add('active');
      
      // Actualizar título de la sección
      const titulos = {
        'inventario': 'Gestión de Inventario',
        'reportes': 'Reportes y Estadísticas',
        'alertas': 'Alertas del Sistema',
        'configuracion': 'Configuración de Usuario'
      };
      document.getElementById('tituloSeccion').textContent = titulos[seccion];
      
      // Si es la sección de reportes, generar los gráficos
      if (seccion === 'reportes') {
        generarReportes();
      }
      
      // Si es la sección de alertas, cargar las alertas
      if (seccion === 'alertas') {
        mostrarAlertas();
      }
    }

    /**
     * Genera los gráficos para la sección de reportes
     */
    function generarReportes() {
      // Destruir gráficos existentes si los hay
      if (charts.chartStock) charts.chartStock.destroy();
      if (charts.chartCategorias) charts.chartCategorias.destroy();
      if (charts.chartPrecios) charts.chartPrecios.destroy();
      if (charts.chartEstadoStock) charts.chartEstadoStock.destroy();
      
      // Gráfico de stock por categoría
      const ctxStock = document.getElementById('chartStock').getContext('2d');
      charts.chartStock = new Chart(ctxStock, {
        type: 'bar',
        data: {
          labels: categorias,
          datasets: [{
            label: 'Total de productos',
            data: categorias.map(cat => 
              productosGlobales.filter(p => p.categoria === cat).length
            ),
            backgroundColor: 'rgba(52, 152, 219, 0.7)',
            borderColor: 'rgba(52, 152, 219, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Productos por categoría'
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
      
      // Gráfico de valor de inventario por categoría
      const ctxCategorias = document.getElementById('chartCategorias').getContext('2d');
      charts.chartCategorias = new Chart(ctxCategorias, {
        type: 'pie',
        data: {
          labels: categorias,
          datasets: [{
            label: 'Valor total',
            data: categorias.map(cat => {
              const productos = productosGlobales.filter(p => p.categoria === cat);
              return productos.reduce((sum, p) => sum + (p.precio * p.cantidad), 0);
            }),
            backgroundColor: [
              'rgba(52, 152, 219, 0.7)',
              'rgba(46, 204, 113, 0.7)',
              'rgba(155, 89, 182, 0.7)',
              'rgba(241, 196, 15, 0.7)',
              'rgba(231, 76, 60, 0.7)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Valor total por categoría'
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return ` $${context.raw.toFixed(2)}`;
                }
              }
            }
          }
        }
      });
      
      // Gráfico de precios promedio
      const ctxPrecios = document.getElementById('chartPrecios').getContext('2d');
      charts.chartPrecios = new Chart(ctxPrecios, {
        type: 'line',
        data: {
          labels: categorias,
          datasets: [{
            label: 'Precio promedio',
            data: categorias.map(cat => {
              const productos = productosGlobales.filter(p => p.categoria === cat);
              return productos.reduce((sum, p) => sum + p.precio, 0) / productos.length || 0;
            }),
            backgroundColor: 'rgba(46, 204, 113, 0.2)',
            borderColor: 'rgba(46, 204, 113, 1)',
            borderWidth: 2,
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Precio promedio por categoría'
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return ` $${context.raw.toFixed(2)}`;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
      
      // Gráfico de estado de stock
      const ctxEstadoStock = document.getElementById('chartEstadoStock').getContext('2d');
      charts.chartEstadoStock = new Chart(ctxEstadoStock, {
        type: 'doughnut',
        data: {
          labels: ['Stock bajo (<10)', 'Stock medio (10-50)', 'Stock alto (>50)'],
          datasets: [{
            label: 'Estado de stock',
            data: [
              productosGlobales.filter(p => p.cantidad < 10).length,
              productosGlobales.filter(p => p.cantidad >= 10 && p.cantidad < 50).length,
              productosGlobales.filter(p => p.cantidad >= 50).length
            ],
            backgroundColor: [
              'rgba(231, 76, 60, 0.7)',
              'rgba(241, 196, 15, 0.7)',
              'rgba(46, 204, 113, 0.7)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Estado del stock'
            }
          }
        }
      });
      
      // Actualizar tabla de stock bajo
      const tbody = document.querySelector("#tablaStockBajo tbody");
      tbody.innerHTML = "";
      
      const stockBajo = productosGlobales.filter(p => p.cantidad < 10);
      
      if (stockBajo.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="5" style="text-align: center; padding: 20px;">
              No hay productos con stock crítico
            </td>
          </tr>
        `;
      } else {
        stockBajo.forEach(prod => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${prod.codigo}</td>
            <td>${prod.nombre}</td>
            <td>${prod.categoria}</td>
            <td>${prod.cantidad}</td>
            <td>${new Date(prod.ultimaActualizacion).toLocaleDateString()}</td>
          `;
          tbody.appendChild(tr);
        });
      }
    }

    /**
     * Guarda la configuración del usuario
     */
    function guardarConfiguracion() {
      const nombre = document.getElementById('nombreUsuarioConfig').value;
      const email = document.getElementById('emailUsuario').value;
      const telefono = document.getElementById('telefonoUsuario').value;
      const notificaciones = document.getElementById('notificaciones').value;
      const limiteStock = document.getElementById('limiteStock').value;
      
      // Aquí normalmente haríamos una petición al servidor para guardar la configuración
      // En este ejemplo solo mostramos un mensaje
      alert(`Configuración guardada:\n\nNombre: ${nombre}\nEmail: ${email}\nTeléfono: ${telefono}\nNotificaciones: ${notificaciones}\nLímite stock bajo: ${limiteStock}`);
      
      // Generar alerta de configuración cambiada
      generarAlerta(
        'Configuración actualizada', 
        'Se han guardado los cambios en la configuración de usuario',
        'informacion'
      );
      
      // Volver a la sección de inventario
      mostrarSeccion('inventario');
    }

    /**
     * Cierra la sesión del usuario y redirige al login
     */
    function cerrarSesion() {
      sessionStorage.clear();
      window.location.href = "../../Pages/index.html";
    }
  </script>
</body>
</html>
